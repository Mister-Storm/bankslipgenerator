# Production Profile Configuration
spring:
  config:
    activate:
      on-profile: production
  datasource:
    url: jdbc:postgresql://${DB_HOST}:${DB_PORT:5432}/${DB_NAME}
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 50
      minimum-idle: 20
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
      leak-detection-threshold: 60000
  flyway:
    enabled: true
    baseline-on-migrate: false
    validate-on-migrate: true
    locations: classpath:db/migration
  redis:
    host: ${REDIS_HOST}
    port: ${REDIS_PORT:6379}
    password: ${REDIS_PASSWORD:}
    ssl: ${REDIS_SSL:true}
    timeout: 5000ms
    lettuce:
      pool:
        max-active: 20
        max-idle: 10
        min-idle: 5
  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: ${JWT_ISSUER_URI}
          jwk-set-uri: ${JWT_JWK_SET_URI}
# Application specific configuration for production
app:
  storage:
    type: s3
    s3:
      bucket: ${S3_BUCKET:bankslip-production}
      region: ${AWS_REGION:us-east-1}
  cnab:
    async-processing: true
    max-batch-size: 1000
  pdf:
    template-path: classpath:templates/bankslip
  security:
    encryption:
      key: ${ENCRYPTION_KEY}
      algorithm: AES/GCM/NoPadding
  rate-limit:
    enabled: true
    default-limit: 1000
    window-seconds: 60
  idempotency:
    enabled: true
    ttl-hours: 24

# Banking API Configuration - Production
banking:
  banco-do-brasil:
    api-url: ${BB_API_URL:https://api.bb.com.br/cobrancas/v2}
    client-id: ${BB_CLIENT_ID}
    client-secret: ${BB_CLIENT_SECRET}
    cert-path: ${BB_CERT_PATH:}
    timeout-ms: 30000
    max-retries: 3
    circuit-breaker:
      enabled: true
      failure-rate-threshold: 50
      wait-duration-in-open-state: 60000

  itau:
    api-url: ${ITAU_API_URL:https://secure.api.itau/cash_management_ext/1.1.0}
    client-id: ${ITAU_CLIENT_ID}
    client-secret: ${ITAU_CLIENT_SECRET}
    cert-path: ${ITAU_CERT_PATH:}
    timeout-ms: 30000
    max-retries: 3
    circuit-breaker:
      enabled: true
      failure-rate-threshold: 50
      wait-duration-in-open-state: 60000

  bradesco:
    api-url: ${BRADESCO_API_URL:https://proxy.api.prebanco.com.br/v1}
    client-id: ${BRADESCO_CLIENT_ID}
    client-secret: ${BRADESCO_CLIENT_SECRET}
    cert-path: ${BRADESCO_CERT_PATH:}
    timeout-ms: 30000
    max-retries: 3
    circuit-breaker:
      enabled: true
      failure-rate-threshold: 50
      wait-duration-in-open-state: 60000

  caixa:
    api-url: ${CAIXA_API_URL:https://api.caixa.gov.br}
    client-id: ${CAIXA_CLIENT_ID}
    client-secret: ${CAIXA_CLIENT_SECRET}
    cert-path: ${CAIXA_CERT_PATH:}
    timeout-ms: 30000
    max-retries: 3
    circuit-breaker:
      enabled: true
      failure-rate-threshold: 50
      wait-duration-in-open-state: 60000

  santander:
    api-url: ${SANTANDER_API_URL:https://trust-open.api.santander.com.br}
    client-id: ${SANTANDER_CLIENT_ID}
    client-secret: ${SANTANDER_CLIENT_SECRET}
    cert-path: ${SANTANDER_CERT_PATH:}
    timeout-ms: 30000
    max-retries: 3
    circuit-breaker:
      enabled: true
      failure-rate-threshold: 50
      wait-duration-in-open-state: 60000

# Webhook Configuration
webhook:
  max-retries: 5
  retry-delay-ms: 5000
  timeout-ms: 10000

# Actuator endpoints for monitoring
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
      base-path: /actuator
  endpoint:
    health:
      show-details: when-authorized
  metrics:
    export:
      prometheus:
        enabled: true
    tags:
      application: ${spring.application.name}
      environment: production

# Logging configuration for production
logging:
  level:
    root: INFO
    br.com.misterstorm.bankslipgenerator: INFO
    org.springframework.web: WARN
    org.springframework.security: WARN
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"
  file:
    name: /var/log/bankslipgenerator/application.log
    max-size: 100MB
    max-history: 30

  security:
    encryption:
      algorithm: AES/GCM/NoPadding
      key: ${ENCRYPTION_KEY}
      keySize: 256
  webhook:
    threadPoolSize: 20
    maxRetries: 3
    retryDelay: 5000
    timeout: 30000
  banks:
    bb:
      apiUrl: https://api.bb.com.br/cobrancas/v2
      authUrl: https://oauth.bb.com.br/oauth/token
    itau:
      apiUrl: https://api.itau.com.br/cash_management/v2
      authUrl: https://api.itau.com.br/auth/oauth/v2/token
    bradesco:
      webserviceUrl: https://cobranca.bradesconetempresa.b.br/ibpjbolorg/services
    caixa:
      apiUrl: https://api.caixa.gov.br/cobranca-bancaria/v1
      certificatePath: ${CAIXA_CERT_PATH}
      certificatePassword: ${CAIXA_CERT_PASSWORD}
    santander:
      apiUrl: https://trust-open.api.santander.com.br/collection_bill/v1
      apiKey: ${SANTANDER_API_KEY}
  rate-limit:
    enabled: true
    default-capacity: 200
    refill-tokens: 20
    refill-period-seconds: 6
  idempotency:
    enabled: true
    ttl-hours: 24
  dead-letter-queue:
    cleanup-enabled: true
    retention-days: 30
# Resilience4j Circuit Breaker configuration
resilience4j:
  circuitbreaker:
    instances:
      bancoDoBrasil:
        slidingWindowSize: 10
        permittedNumberOfCallsInHalfOpenState: 3
        waitDurationInOpenState: 30s
        failureRateThreshold: 50
        automaticTransitionFromOpenToHalfOpenEnabled: true
      itau:
        slidingWindowSize: 10
        permittedNumberOfCallsInHalfOpenState: 3
        waitDurationInOpenState: 30s
        failureRateThreshold: 50
      bradesco:
        slidingWindowSize: 10
        permittedNumberOfCallsInHalfOpenState: 3
        waitDurationInOpenState: 30s
        failureRateThreshold: 50
      webhook:
        slidingWindowSize: 20
        permittedNumberOfCallsInHalfOpenState: 5
        waitDurationInOpenState: 60s
        failureRateThreshold: 60
  retry:
    instances:
      bancoDoBrasil:
        maxAttempts: 3
        waitDuration: 5s
        exponentialBackoffMultiplier: 2
      itau:
        maxAttempts: 3
        waitDuration: 5s
        exponentialBackoffMultiplier: 2
      bradesco:
        maxAttempts: 3
        waitDuration: 5s
        exponentialBackoffMultiplier: 2
# Actuator configuration for production
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: when-authorized
  metrics:
    export:
      prometheus:
        enabled: true
# Logging configuration for production
logging:
  level:
    root: INFO
    br.com.misterstorm.bankslipgenerator: INFO
    org.springframework.web: WARN
    org.springframework.jdbc: WARN
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
  file:
    name: /var/log/bankslipgenerator/application.log
    max-size: 100MB
    max-history: 30
    total-size-cap: 1GB
